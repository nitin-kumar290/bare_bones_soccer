{% extends "base.html" %}
{% load static %}
{% block title %}Barebones Soccer Events - Denver & Colorado pickup Soccer Events{% endblock %}

{% block content %}
{% if messages %}
{% for message in messages %}
    <div class="alert alert-info fade-in text-center fw-bold">{{ message }}</div>
{% endfor %}
{% endif %}


<!-- <div class="container my-1 px-5">
    <div class="bg-white text-dark pt-3 text-center">
        <h1 class="text-center" style="font-size:16px; font-weight:700; letter-spacing:3px; text-transform:uppercase; color: #dc3545;">
            ðŸ”¥ UPCOMING EVENT ðŸ”¥
        </h1>
        <h2 style="font-family: 'Oswald', sans-serif; font-size: 1.5rem;">BARE BONES SOCCER WAREHOUSE PARTY</h2>
        <h6>Thursday, Nov 20th 2025 | 6:30-9:30 PM</h6>
        <h6>The Brighton</h6>
        <h6>3403 Brighton Blvd, Denver, Colorado</h6>


         <p style="font-family: 'Oswald'; font-size: 14px; font-style: italic;">
            FREE Pickup Soccer, 4 courts, Prizes + Food & Drinks 
        </p> 
    </div>
</div>


<div class="container my-1">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card border-secondary">
                <div class="card-body text-center">
                    <h5 class="card-title text-danger">RSVP NOW!</h5>
                    <form method="post" action="{% url 'event_rsvp' %}">
                        {% csrf_token %}
                        <div class="input-group mb-3">
                            <input type="email" name="email" class="form-control" placeholder="Enter your email" required>
                            <button class="btn btn-secondary" type="submit">RSVP</button>
                        </div>
                    </form>
                    <p class="card-text" style="font-family: 'Bebas Neue Pro'; font-size: 14px;">
                        *Must have Bare Bones Soccer account to play* <br>
                        Create Account <a href="{% url 'register' %}" style="font-style: italic;">HERE</a> if you don't have one.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container my-3">
    <div class="video-container">
        <div class="video-wrapper">
            <video 
                id="customVideo"
                width="100%" 
                loop 
                playsinline
                preload="metadata"
                class="promo-video">
                <source src="{% static 'videos/brighton_event_vid.webm' %}" type="video/webm">
                <source src="{% static 'videos/brighton_event_vid.mp4' %}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div class="play-button-overlay" id="playButton">
                <div class="play-button">â–¶</div>
            </div>
        </div>
    </div>
</div>

<style>
.video-container {
    max-width: 650px;
    height: 450px;
    margin: 0 auto;
    /* border-radius: 8px; */
    overflow: hidden;
    /* box-shadow: 0 4px 12px rgba(0,0,0,0.1); */
}

.video-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
}

.promo-video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center;
}

.play-button-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.3);
    cursor: pointer;
}

.play-button {
    width: 80px;
    height: 80px;
    background: rgba(255,255,255,0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    color: #333;
    transition: transform 0.2s;
}

.play-button:hover {
    transform: scale(1.1);
}

.play-button-overlay.hidden {
    display: none;
}

@media (max-width: 768px) {
    .video-container {
        max-width: 100%;
        height: 400px;
        margin: 0 15px;
    }
    
    .play-button {
        width: 60px;
        height: 60px;
        font-size: 24px;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const video = document.getElementById('customVideo');
    const playButton = document.getElementById('playButton');
    
    playButton.addEventListener('click', function() {
        video.play();
        playButton.classList.add('hidden');
    });
    
    video.addEventListener('pause', function() {
        playButton.classList.remove('hidden');
    });
});
</script> -->


<!-- <hr class="my-2 border-secondary opacity-50 border-2 py-4"> -->


<div class="container my-1 px-5">
    <div class="bg-white text-dark pt-3 text-center">
        <h1 class="text-center" style="font-size:16px; font-weight:700; letter-spacing:3px; text-transform:uppercase; color: #dc3545;">
            ðŸ”¥ Next EVENT ðŸ”¥
        </h1>
        <h2 style="font-family: 'Oswald', sans-serif; font-size: 1.5rem;">BARE BONES BRUNCH BALL</h2>
        <h6>Sunday, Dec 7 2025 | 10:30 AM-1:30 PM</h6>
        <h6>WÃ¤ldschanke Ciders</h6>
        <h6>4100 Jason St, Denver, CO</h6>

        <!-- <p class="py-2" style="font-family: 'Bebas Neue Pro'; font-size: 16px;">
            Rapids vs. Dynamo
        </p> -->
         <p style="font-family: 'Oswald'; font-size: 14px; font-style: italic;">
            NONSTOP pickup games, Brunch Menu, FREE Drink, Player Prize Entry & More!
        </p> 
    </div>
</div>






<!-- Combined Purchase & Stats Box -->
<div class="container my-4">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="purchase-card">
                <p class="purchase-note pb-3">
                    *Must have Bare Bones Soccer account* <br>
                    Create Account <a href="{% url 'register' %}" class="account-link">HERE</a> if you don't have one.
                </p>
                {% if player_cap_reached %}
                    <!-- Capacity Reached Version -->
                    <div class="capacity-alert mb-3">
                        <span class="alert-icon">âš½</span>
                        <span class="alert-text">PLAYER SPOTS FULL!</span>
                    </div>
                    
                    {% if user.is_authenticated %}
                        <button class="purchase-btn spectator-btn" onclick="registerAsSpectator()">
                            <span class="btn-text">ðŸ‘¥ REGISTER AS SPECTATOR</span>
                            <span class="btn-icon">â†’</span>
                        </button>
                    {% else %}
                        <a href="{% url 'login' %}?next={% url 'waldschanke' %}" class="purchase-btn spectator-btn">
                            <span class="btn-text">ðŸ‘¥ REGISTER AS SPECTATOR</span>
                            <span class="btn-icon">â†’</span>
                        </a>
                    {% endif %}
                    
                    <div class="price-section">
                        <span class="price">FREE</span>
                        <span class="price-label">spectator entry</span>
                    </div>
                {% else %}
                    <!-- Normal Version -->
                    {% if user.is_authenticated %}
                        <button class="purchase-btn" onclick="buyTicketNow()">
                            <span class="btn-text">ðŸŽ« BUY TICKET NOW</span>
                            <span class="btn-icon">â†’</span>
                        </button>
                    {% else %}
                        <a href="{% url 'login' %}?next={% url 'waldschanke' %}" class="purchase-btn">
                            <span class="btn-text">ðŸŽ« BUY TICKETS NOW</span>
                            <span class="btn-icon">â†’</span>
                        </a>
                    {% endif %}

                    
                    <div class="price-section">
                        <span class="price">$15</span>
                        <span class="price-label">per person</span>
                    </div>
                {% endif %}

                <div class="spots-counter">
                    <span class="spots-text"><strong>{{ paid_players_count }}/36 SPOTS TAKEN</strong></span>
                </div>
                
                
            </div>
        </div>
    </div>
</div>


<script src="https://js.stripe.com/v3/"></script>
<script>
const stripe = Stripe("pk_live_51Qe6VrKKPDelkA7OgycGGoqfOS3cfz4k6KQ53R2LvHJann8fxkRLFX2XF7CwBxqLOc8WfXpv3lLurLmh0og9TUlX00VSXk1ZM7");

async function buyTicketNow() {
    try {
        const res = await fetch("/api/create-waldschanke-checkout-session", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            }
        });
        const session = await res.json();

        if (!session.id) throw new Error("No session ID returned.");
        
        await stripe.redirectToCheckout({ sessionId: session.id });
    } catch (err) {
        console.error(err);
        alert("Error creating checkout. Please try again.");
    }
}

async function registerAsSpectator() {
    try {
        const res = await fetch("/api/register-free-spectator", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            }
        });
        
        if (res.ok) {
            const data = await res.json();
            if (data.redirect) {
                window.location.href = data.redirect;
            }
        } else {
            const error = await res.json();
            alert(error.error || "Registration failed. Please try again.");
        }
    } catch (err) {
        console.error(err);
        alert("Error registering. Please try again.");
    }
}
</script>



<style>
.purchase-card {
    background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
    border: 1px solid #d64f5d;
    border-radius: 16px;
    padding: 1.5rem;  /* Reduced from 2rem */
    text-align: center;
    box-shadow: 0 8px 32px rgba(220, 53, 69, 0.15);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.purchase-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(220, 53, 69, 0.25);
}

.spots-counter {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 25px;
    padding: 0.5rem 1rem;
    margin-bottom: 1rem;
    display: inline-block;
}

.spots-text {
    font-family: 'Oswald', sans-serif;
    font-size: 0.9rem;
    font-weight: 800;
    color: #212529;
    letter-spacing: 1px;
    text-transform: uppercase;
}


.purchase-btn {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    border: none;
    border-radius: 50px;
    padding: 1rem 2.5rem;
    font-size: 1.1rem;
    font-weight: 700;
    color: white;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    width: 100%;
    max-width: 320px;
    margin: 0 auto 1rem auto;  /* Reduced from 1.5rem */
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
    text-decoration: none;
    white-space: nowrap;
}

.purchase-btn:hover {
    background: linear-gradient(135deg, #c82333 0%, #a71e2a 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(220, 53, 69, 0.6);
}

.btn-text {
    flex: 1;
}

.btn-icon {
    font-size: 1.2rem;
    transition: transform 0.3s ease;
}

.purchase-btn:hover .btn-icon {
    transform: translateX(4px);
}

.price-section {
    margin-bottom: 1rem;
}

.price {
    font-size: 2.5rem;
    font-weight: 800;
    color: #dc3545;
    font-family: 'Oswald', sans-serif;
}

.price-label {
    display: block;
    font-size: 0.9rem;
    color: #6c757d;
    margin-top: 0.25rem;
}

.purchase-note {
    font-family: 'Bebas Neue Pro';
    font-size: 14px;
    color: #6c757d;
    line-height: 1.4;
    margin: 0;
}

.account-link {
    color: #dc3545;
    text-decoration: none;
    font-weight: 600;
    transition: color 0.3s ease;
}

.account-link:hover {
    color: #c82333;
    text-decoration: underline;
}

.spectator-btn {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.spectator-btn:hover {
    background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);
}

.capacity-alert {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border: 1px solid #ffeaa7;
    border-radius: 12px;
    padding: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.alert-icon {
    font-size: 1.2rem;
}

.alert-text {
    font-size: 0.9rem;
    font-weight: 600;
    color: #856404;
}


@media (max-width: 768px) {
    .purchase-card {
        padding: 1.5rem;
        margin: 0 1rem;
    }
    
    .price {
        font-size: 2rem;
    }
    
    .purchase-btn {
        font-size: 1rem;
        padding: 0.9rem 2rem;
    }
}
</style>




<!-- Image gallery -->
<div class="image-gallery py-2 pb-5">
    <div class="row g-1">
        <div class="col-4">
            <img src="{% static 'images/Waldyevent1.jpeg' %}" class="gallery-img" alt="pickup soccer at WaldschÃ¤nke Ciders & Coffee denver colorado">
        </div>
        <div class="col-4">
            <img src="{% static 'images/waldyevent2.jpeg' %}" class="gallery-img" alt="pickup soccer at WaldschÃ¤nke Ciders & Coffee denver colorado">
        </div>
        <div class="col-4">
            <img src="{% static 'images/waldyevent3.jpeg' %}" class="gallery-img" alt="pickup soccer at WaldschÃ¤nke Ciders & Coffee denver colorado">
        </div>
    </div>
</div>

<style>
.image-gallery {
    max-width: 500px;
    margin: 0 auto;
}

.gallery-img {
    width: 100%;
    height: 250px;  
    aspect-ratio: 4 / 5;   /* makes frame taller */
    object-fit: contain;
    object-position: center;
    display: block;
    border-radius: 6px;    /* optional: soft corners */
}

@media (min-width: 768px) {
    .image-gallery {
        max-width: 80%;
    }
    .gallery-img {
        height: 300px;     /* Larger height for tablets */
        aspect-ratio: 3 / 4;
    }
}

@media (min-width: 992px) {
    .image-gallery {
        max-width: 90%;
    }
    .gallery-img {
        height: 350px;     /* Larger height for desktop */
        aspect-ratio: 16 / 20;
    }
}
</style>

<!-- <div class="image-gallery py-2 pb-5">
    <div class="row g-1">
        <div class="col-4">
            <img src="{% static 'images/cidery_event2.jpeg' %}" class="gallery-img" alt="Sport Stable 1">
        </div>
        <div class="col-4">
            <img src="{% static 'images/cidery_middle.jpg' %}" class="gallery-img" alt="Sport Stable 2">
        </div>
        <div class="col-4">
            <img src="{% static 'images/cidery_event.jpeg' %}" class="gallery-img" alt="Sport Stable 3">
        </div>
    </div>
</div>

<style>
.image-gallery {
    max-width: 400px;
    margin: 0 auto;
}

.gallery-img {
    width: 100%;
    height: 160px;
    max-height: 160px;
    object-fit: cover;
    object-position: center;
    /* aspect-ratio: 4/3;
    object-fit: contain; */
}

@media (min-width: 768px) {
    .image-gallery {
        max-width: 80%;
    }
    .gallery-img {
        height: 240px;
        max-height: 240px;
    }
}

@media (min-width: 992px) {
    .image-gallery {
        max-width: 90%;
    }
    .gallery-img {
        height: 300px;
        max-height: 300px;
    }
}
</style> -->


<hr class="my-2 border-secondary opacity-50 border-2 py-4">

<!-- NEWS grid -->
<div class="container my-2" style="max-width:1240px;">
  <h1 class="text-center" style="font-size:16px; font-weight:700; letter-spacing:3px; text-transform:uppercase;">
    News
  </h1>

  <!-- 1 column on phones, 2 on tablets, 4 on desktops -->
  <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-5" style="margin:0;">
    {% for event in events %}
    <div class="col" style="display:flex;">
      <a href="{{ event.get_absolute_url }}" class="news-card" style="display:block; width:100%; text-decoration:none; color:#111;">
        <!-- Image wrapper -->
        <div style="position:relative; overflow:hidden; background:#f3f3f3;">
          <!-- Use aspect-ratio to keep the same feel (roughly 4:3 like the reference) -->
          <img src="{{ event.image.url }}"
               alt="{{ event.title }}"
               style="display:block; width:100%; aspect-ratio: 4 / 3; object-fit:cover; transition:transform .35s ease; will-change:transform;">
        </div>

        <!-- Caption -->
        <div style="text-align:center; margin-top:16px;">
          <div style="font-size:12px; line-height:1.6; letter-spacing:1.5px; text-transform:uppercase;">
            {{ event.title }}
          </div>
          <div style="font-size:8px; line-height:1.6; letter-spacing:1.5px; text-transform:uppercase;">
            
          </div>
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Tiny bit of CSS for the hover zoom (kept inline in this file) -->
<style>
  .news-card:hover img { transform: scale(1.03); }
</style>

<!-- <div class="container my-5">
    <h1 class="text-center mb-4">Our Events</h1>
    <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for event in events %}
        <div class="col">
            <div class="card h-100">
                <img src="{{ event.image.url }}" class="card-img-top" alt="{{ event.title }}">
                <div class="card-body">
                    <h5 class="card-title">{{ event.title }}</h5>
                    <p class="card-text">{{ event.description|truncatewords:15 }}</p>
                    <a href="{{ event.get_absolute_url }}" class="btn btn-primary">View Details</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div> -->
{% endblock %}
